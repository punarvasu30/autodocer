<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoDocER Custom UI</title>
    <style>
        body { font-family: sans-serif; margin: 0; display: flex; height: 100vh; font-size: 14px; }
        #left-panel { width: 350px; border-right: 1px solid #ccc; padding: 15px; overflow-y: auto; background-color: #f9f9f9; flex-shrink: 0;}
        #right-panel { flex-grow: 1; padding: 15px; overflow-y: auto; }
        h2, h3 { margin-top: 0; border-bottom: 1px solid #eee; padding-bottom: 5px; color: #333;}
        h3 { margin-top: 20px; font-size: 1.1em; }
        ul { list-style: none; padding: 0; margin: 0; }
        li { padding: 8px 5px; cursor: pointer; border-bottom: 1px solid #eee; font-size: 0.9em; word-break: break-all; }
        li:hover { background-color: #eee; }
        li.selected { background-color: #007bff; color: white; font-weight: bold;}
        pre { background-color: #f0f0f0; padding: 10px; border: 1px solid #ddd; border-radius: 4px; white-space: pre-wrap; word-wrap: break-word; font-size: 0.85em; max-height: 300px; overflow-y: auto; }
        code { background-color: #f0f0f0; padding: 2px 4px; border-radius: 3px; font-family: monospace; }
        .method { font-weight: bold; padding: 3px 6px; border-radius: 3px; color: white; margin-right: 8px; font-size: 0.9em;}
        .method-get { background-color: #61affe; }
        .method-post { background-color: #49cc90; }
        .method-put { background-color: #fca130; }
        .method-delete { background-color: #f93e3e; }
        .method-patch { background-color: #50e3c2; }
        .param-table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.9em; }
        .param-table th, .param-table td { border: 1px solid #ddd; padding: 6px; text-align: left; }
        .param-table th { background-color: #f9f9f9; font-weight: bold;}
        .error { color: red; font-weight: bold;}
        .loading { color: #888; font-style: italic;}
        .schema-section { margin-top: 15px; }
        .schema-title { font-weight: bold; margin-bottom: 5px; }
    </style>
</head>
<body>

<div id="left-panel">
    <h2>API Paths</h2>
    <ul id="paths-list">
        <li class="loading">Loading Paths...</li>
    </ul>
</div>

<div id="right-panel">
    <h2>Details</h2>
    <div id="details-content">
        <p>Select a path from the left panel.</p>
    </div>
</div>

<script>
    let fullApiSpec = null; // Store the fetched spec

    // --- NEW: Enhanced displayDetails Function ---
    function displayDetails(pathKey, listItemElement) {
        const detailsDiv = document.getElementById('details-content');
        detailsDiv.innerHTML = ''; // Clear previous content

        // --- Highlight selection in left panel ---
        document.querySelectorAll('#paths-list li.selected').forEach(el => el.classList.remove('selected'));
        if (listItemElement) {
             listItemElement.classList.add('selected');
        }
        // --- End Highlight ---

        if (!fullApiSpec || !fullApiSpec.paths || !fullApiSpec.paths[pathKey]) {
            detailsDiv.innerHTML = '<p class="error">Details not found for this path.</p>';
            return;
        }

        const pathItem = fullApiSpec.paths[pathKey];
        let contentHtml = `<h2>Path: <code>${pathKey}</code></h2>`;

        // Loop through HTTP methods (get, post, etc.) defined for this path
        Object.entries(pathItem).forEach(([httpMethod, operation]) => {
            const methodUpper = httpMethod.toUpperCase();
            contentHtml += `<h3 style="margin-top: 25px;"><span class="method method-${httpMethod}">${methodUpper}</span> ${operation.summary || operation.operationId || ''}</h3>`;
            if (operation.description) {
                contentHtml += `<p>${operation.description}</p>`;
            }

            // --- Display Parameters ---
            if (operation.parameters && operation.parameters.length > 0) {
                contentHtml += `<h4>Parameters</h4>`;
                contentHtml += `<table class="param-table"><thead><tr><th>Name</th><th>In</th><th>Required</th><th>Schema</th></tr></thead><tbody>`;
                operation.parameters.forEach(param => {
                    contentHtml += `<tr>
                                        <td><code>${param.name}</code></td>
                                        <td>${param.in}</td>
                                        <td>${param.required ? 'Yes' : 'No'}</td>
                                        <td><pre>${JSON.stringify(param.schema, null, 2)}</pre></td>
                                    </tr>`;
                });
                contentHtml += `</tbody></table>`;
            } else {
                 contentHtml += `<p>Parameters: None</p>`
            }

            // --- Display Request Body ---
            if (operation.requestBody) {
                contentHtml += `<h4>Request Body</h4>`;
                contentHtml += `<p>Required: ${operation.requestBody.required ? 'Yes' : 'No'}</p>`;
                if (operation.requestBody.content && operation.requestBody.content['application/json'] && operation.requestBody.content['application/json'].schema) {
                    contentHtml += `<div class="schema-section"><div class="schema-title">Schema (application/json):</div><pre>${JSON.stringify(operation.requestBody.content['application/json'].schema, null, 2)}</pre></div>`;
                } else {
                    contentHtml += `<p>No schema defined for request body.</p>`;
                }
            }

            // --- Display Responses ---
            if (operation.responses) {
                contentHtml += `<h4>Responses</h4>`;
                Object.entries(operation.responses).forEach(([statusCode, response]) => {
                     contentHtml += `<div><strong>${statusCode}:</strong> ${response.description || ''}</div>`;
                     if (response.content && response.content['application/json'] && response.content['application/json'].schema) {
                         contentHtml += `<div class="schema-section"><div class="schema-title">Schema (application/json):</div><pre>${JSON.stringify(response.content['application/json'].schema, null, 2)}</pre></div>`;
                     }
                });
            }
            contentHtml += '<hr style="margin-top: 25px;">'; // Separator between methods
        });

        detailsDiv.innerHTML = contentHtml;
    }


    // --- loadApiPaths Function remains the same, but updates the click listener ---
    async function loadApiPaths() {
        const pathsList = document.getElementById('paths-list');
        try {
            const response = await fetch('/autodocer/api-docs');
            if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
            fullApiSpec = await response.json();
            console.log("Fetched Spec:", fullApiSpec);

            pathsList.innerHTML = '';

            if (!fullApiSpec || !fullApiSpec.paths || Object.keys(fullApiSpec.paths).length === 0) {
                 pathsList.innerHTML = '<li>No paths found.</li>';
                 return;
            }

            const paths = Object.keys(fullApiSpec.paths).sort();
            paths.forEach(pathKey => {
                const listItem = document.createElement('li');

                // Add method badges to the list item for quick reference
                let methodsHtml = '';
                const pathItem = fullApiSpec.paths[pathKey];
                Object.keys(pathItem).forEach(method => {
                    methodsHtml += `<span class="method method-${method}" style="font-size: 0.8em; margin-right: 4px;">${method.toUpperCase()}</span> `;
                });
                listItem.innerHTML = methodsHtml + pathKey; // Prepend methods to path

                // UPDATE: Pass 'listItem' to the click handler for highlighting
                listItem.addEventListener('click', (event) => displayDetails(pathKey, event.currentTarget));
                pathsList.appendChild(listItem);
            });

        } catch (error) {
            console.error("Error loading API paths:", error);
            pathsList.innerHTML = `<li class="error">Error loading data: ${error.message}</li>`;
            document.getElementById('details-content').innerHTML = `<p class="error">Could not load API specification.</p>`
        }
    }

    window.onload = loadApiPaths;
</script>

</body>
</html>

